USE [dbFinishingSystem]
GO
/****** Object:  Trigger [dbo].[trgInsertWarehouse]    Script Date: 06/02/2024 10:52:24 a. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		Raúl Reyes Muñoz
-- Create date: 2023-08-15
-- Description:	This trigger is used to update all warehouses when the user move some value in records from dbFinishingSystem o dbInspeqtorNew
-- =============================================
ALTER TRIGGER [dbo].[trgInsertWarehouse]
   ON  [dbo].[tblRulos] 
   AFTER INSERT
AS 
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	--CASE 1 WHEN RULO IS CREATED IN tblMigrationControl: 1=RAW1. Migration Category: 3=Crudo or 4=Crugo-G. CREATE TRIGGER WHEN RECORD IS INSERTED IN tblMigrationControl
	--CASE 2 WHEN RULO IS CREATED IN tblMigrationControl: 2=RAW2. Migration Category: 3!=Crudo and 4!=Crugo-G Pre-Process. CREATE TRIGGER WHEN RECORD IS INSERTED IN tblMigrationControl
	--**CASE 3 WHEN RULO IS CREATED OR TEST RESULT IS NULL: 3=A1. WHEN USER CREATED A RECORD TEST RESULT IS NULL, THIS STATUS IS BY DEFAULT
	--CASE 4 WHEN TEST RESULT: 6=FAIL X OR 7=WAITING: 4=A2
	--CASE 5 WHEN TEST RESULT: 3,4,5 :5=A3

	--CASE 6 WHEN RULO IS CREATED IN GUVEN SYSTEM OR INSPECTION CUTTING LENGHT = 0: 6=QC1.THIS TRIGGER MIGHT BE CREATED IN dbInspeqtorNew
	--CASE 7 WHEN RULO IN dbInpeqtorNew HAS INSPECTION CUTTING LENGHT >= 0: 7=QC2. THIS TRIGGER MIGHT BE CREATED IN dbInspeqtorNew
	
	--CASE 3
	UPDATE tblRulos	SET WarehouseCategoryID = 3 WHERE IsDeleted <> 1 AND RuloID = (SELECT TOP 1 RuloID FROM inserted)

END